rm(list = ls())

setwd("D:/Meryl - Professional/Projects/Active Projects/USGS National Fishes Rarity Project/Smithetal_AOO_2018/Code")

install.packages("ggpubr")
install.packages("dplyr")
install.packages("RColorBrewer")

library("ggpubr")
library("dplyr")
library("RColorBrewer")
source('colorRampPaletteAlpha.R') #available in GitHub and here: http://www.everydayanalytics.ca/2014/03/colorRampPalette-alpha-in-R.html

AOO <-read.csv("All_AOO.csv")

#Define variables for plotting
AOO1km <- log(AOO$total_area_1km)
AOO5km <- log(AOO$total_area_5km)
AOO10km <- log(AOO$total_area_10km)
AOO20km <- log(AOO$total_area_20km)
HUC8 <- log(AOO$total_area_huc8)
HUC12 <- log(AOO$total_area_huc12)
MCP <- log(AOO$total_area_MCP)
NS <- log(AOO$total_area_NatureServe)
AOO_Mean <- AOO$mean_Rank
AOO_SD <- AOO$sd_Rank

#Colors for Buffered metrics
b1 <-"cornflowerblue"
b5 <-"cyan3"
b10 <-"darkgoldenrod2"
b20 <-"chocolate2"
ba1 <- addalpha(b1, 0.7)
ba5 <- addalpha(b5, 0.7)
ba10 <-addalpha(b10, 0.7)
ba20 <- addalpha(b20, 0.7)

#Colors for HUCs
h8 <- "chocolate2"
h12 <- "cornflowerblue"
ha8 <- addalpha(h8, 0.7)
ha12 <- addalpha(h12, 0.7)

#Color for MCP
MCPcol <- "chocolate2"
MCPcola <- addalpha(MCPcol,0.5)

#Color for SD plot (Fig 4)
SD <- "grey"
SDa <- addalpha(SD,0.7)

#############################################

#Figure 3

png("Figure3.png", width=4.5, height=11, units="in", res=300)
par(mfrow=c(3,1))

#3A: buffered points vs. NatureServe
par(mar=c(1,5,1,1))
plot(AOO1km, NS, xlim=c(8,15), ylim=c(0,16), type="n",
     xlab="", ylab="log(AOO by Buffered Points)", cex.axis=1.5, cex.lab=1.5, xaxt="n", las=1)
abline(lm(AOO1km ~ NS), lwd=2, col=b1)
abline(lm(AOO5km ~ NS), lwd=2, col=b5)
abline(lm(AOO10km ~ NS), lwd=2, col=b10)
abline(lm(AOO20km ~ NS), lwd=2, col=b20)
points(NS, AOO1km, pch=21, bg=ba1, cex=2.5)
points(NS, AOO5km, pch=21, bg=ba5, cex=2.5)
points(NS, AOO10km, pch=21, bg=ba10, cex=2.5)
points(NS, AOO20km, pch=21, bg=ba20, cex=2.5)
legend(8, 15, legend=c("1km", "5km", "10km", "20km"), pch=21, pt.cex=2, cex=1.5, pt.bg=c(ba1, ba5, ba10, ba20), box.lty=0)
text(8, 16, "A", cex=2.5)

#3B: HUCs vs. NatureServe
par(mar=c(2,5,1,1))
plot(HUC8, NS, xlim=c(8,15), ylim=c(0,16), type="n",
     xlab="", ylab="log(AOO by HUCs)", cex.axis=1.5, cex.lab=1.5, xaxt="n", las=1)
abline(lm(HUC8 ~ NS), lwd=2, col=h8)
abline(lm(HUC12 ~ NS), lwd=2, col=h12)
points(NS, HUC8, pch=24, bg=ha8, cex=2.5)
points(NS, HUC12, pch=24, bg=ha12, cex=2.5)
legend(8, 15, legend=c("HUC8", "HUC12"), pch=24, pt.cex=2, cex=1.5, pt.bg=c(ha8, ha12), box.lty=0)
text(8, 16, "B", cex=2.5)

#3C: MCP vs. NatureServe
par(mar=c(5,5,0,1))
plot(MCP, NS, xlim=c(8,15), ylim=c(0,16), type="n",
     xlab="log(AOO by NatureServe)", ylab="log(AOO by MCP)", cex.axis=1.5, cex.lab=1.5, las=1)
abline(lm(MCP ~ NS), lwd=2, col=MCPcol)
points(NS, MCP, pch=22, bg=MCPcola, cex=2.5)
legend(8, 15, legend=c("MCP"), pch=22, pt.cex=2.5, cex=1.5, pt.bg=MCPcola, box.lty=0)
text(8, 16, "C", cex=2.5)

dev.off()


##########################################

#Quadratic model of SD vs. mean Rank AOO

AOO_Mean2 <- AOO_Mean*AOO_Mean
QuadraticSD <- lm(AOO_SD ~ AOO_Mean + AOO_Mean2)
sink("RankAOOvsSD_QuadMod.txt") #write output to text
summary(QuadraticSD) #Check significance of the quadratic model
sink()


##########################################

#Figure 4

png("Figure4.png", width=6, height=6, units="in", res=300)

i <- seq(min(AOO_Mean),max(AOO_Mean),len=128)
predictQSD <- predict(QuadraticSD, data.frame(AOO_Mean=i, AOO_Mean2=i*i))
predictQSD_int <- predict(QuadraticSD, data.frame(AOO_Mean=i, AOO_Mean2=i*i), interval="confidence", level=0.99)

plot(AOO_Mean, AOO_SD,type="n", las=1, xlab="Mean AOO Ranking", ylab="Standard Deviation of AOO Ranking", cex.lab=1.1)
lines(AllMeans, predictQSD, lwd=2)
lines(AllMeans, predictQSD_int[,2], col="black", lwd=2, lty=2)
lines(AllMeans, predictQSD_int[,3], col="black", lwd=2, lty=2)
points(AOO_Mean, AOO_SD, pch=21, bg=SDa, cex=2.5)
text(90,35,"Y = -0.003X^2 + 0.428X + 1.272") #insert values manually from summary of quadratic model

dev.off()

