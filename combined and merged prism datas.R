rm(list=ls())

install.packages('doParallel')
install.packages('foreach')

library(prism)
library(devtools) #needed to download prism from github
library(raster) ##working with raster data
library(sp) ##manipulationg spatial data
library(rgdal)
library(doParallel) #allows parallel computing
library(foreach)  #need this with doparallel
library(ff)

#code to extract prism data
#get_prism_annual(type = "tmax", year = 1981:1985, keepZip = FALSE)

###START OF HUC8 PRISM DATA###

#1
###HUC8 tmax
FILES_SHPHUC8 <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\unique HUC8 data\\shapefiles HUC8\\", pattern = "\\.shp$")#create file list for loop
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmax") #path for prism data
UseCores <- detectCores() -1 #detects one minus the max number of cores
cl <- makeCluster(UseCores) #create copies of R to run parallel
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84") #set coordinate system
prism_years <- t(ls_prism_data()) #create a list of prism years
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/stack.ffdata")) #save the RS stack to disk
for(i in 1:nlayers(RS)){ #create a matrix the size of the raster stack
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/data.RData") #save the matrix
registerDoParallel(cl) #regist the cluster for parallel processing
#must include the library used inside the loop
foreach (i = 1:length(FILES_SHPHUC8)) %dopar% { 
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_SHPHUC8[i], 1, nchar(FILES_SHPHUC8[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\unique HUC8 data\\shapefiles HUC8", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]]) 
  ID_Raster[] <- 1:ncell(RS[[1]]) #helps R identify where to retrieve the data from the data into the matrix
  ext_ID <- extract(ID_Raster,species) #extract the data 
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),]) #turn the list extract output into a dataframe
  colnames(ext2) <- prism_years #rename the column names as the years
  df_min_tempmax <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE))) #create vector of min values
  colnames(df_min_tempmax) <- "Min Temp Max" #rename the vector
  df_max_tempmax <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE))) #create vector of max values
  colnames(df_max_tempmax) <- "Max Temp Max" #rename the vector
  min_max_tmax <- cbind(df_min_tempmax, df_max_tempmax) #column bind the min and max vectors
  write.csv(min_max_tmax, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/tmax/", dat.name,".csv"), row.names=TRUE) #save the file
}
stopCluster(cl) #stop the parallel process

#2
###HUC8 tmin
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmin") #path for prism data
UseCores <- detectCores() -1 #detects one minus the max number of cores
cl <- makeCluster(UseCores) #create copies of R to run parallel
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84") #set the coordinate system
prism_years <- t(ls_prism_data()) #list of prism year names
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/stack.ffdata")) #RS saved onto disk
for(i in 1:nlayers(RS)){ #matrix the size of the RS stack
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/data.RData") #save the matrix
registerDoParallel(cl) #register the cluster for parallel process
foreach (i = 1:length(FILES_SHPHUC8)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_SHPHUC8[i], 1, nchar(FILES_SHPHUC8[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\unique HUC8 data\\shapefiles HUC8", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]]) #helps R identify where to extract the data from our preallocated saved file
  ext_ID <- extract(ID_Raster,species) #performs the comparison and extraction
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),]) #turn the list output into a dataframe
  colnames(ext2) <- prism_years #rename the columns to prism years
  df_min_tempmin <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE))) #create min value vector
  colnames(df_min_tempmin) <- "Min Temp Min" #rename vector
  df_max_tempmin <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE))) #create max value vector
  colnames(df_max_tempmin) <- "Max Temp Min" #rename vector
  min_max_tmin <- cbind(df_min_tempmin, df_max_tempmin) #column bind the min and max vector
  write.csv(min_max_tmin, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/tmin/", dat.name,".csv"), row.names=TRUE) #save the dataframe
} 
stopCluster(cl) #stop the parallel process

#3
###HUC8 tmean
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmean") #path for prism data
UseCores <- detectCores() -1 #detects one minus the max number of cores
cl <- makeCluster(UseCores) #create copies of R to run parallel
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84") 
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/data.RData")
registerDoParallel(cl)
foreach (i = 1:length(FILES_SHPHUC8)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_SHPHUC8[i], 1, nchar(FILES_SHPHUC8[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\unique HUC8 data\\shapefiles HUC8", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min_tempmean <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min_tempmean) <- "Min Temp Mean"
  df_max_tempmean <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max_tempmean) <- "Max Temp Mean"
  min_max_tmean <- cbind(df_min_tempmean, df_max_tempmean)
  write.csv(min_max_tmean, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/tmean/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#4
###HUC8 ppt
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\ppt") #path for prism data
UseCores <- detectCores() -1 #detects one minus the max number of cores
cl <- makeCluster(UseCores) #create copies of R to run parallel
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84") 
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/data.RData")
registerDoParallel(cl)
foreach (i = 1:length(FILES_SHPHUC8)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_SHPHUC8[i], 1, nchar(FILES_SHPHUC8[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\unique HUC8 data\\shapefiles HUC8", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min_ppt <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min_ppt) <- "Min PPT"
  df_max_ppt <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max_ppt) <- "Max PPT"
  min_max_ppt <- cbind(df_min_ppt, df_max_ppt)
  write.csv(min_max_ppt, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/ppt/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#5
###HUC8 tmax aug
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmax AUG") #path for prism data
UseCores <- detectCores() -1 #detects one minus the max number of cores
cl <- makeCluster(UseCores) #create copies of R to run parallel
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84") 
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/data.RData")
registerDoParallel(cl)
foreach (i = 1:length(FILES_SHPHUC8)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_SHPHUC8[i], 1, nchar(FILES_SHPHUC8[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\unique HUC8 data\\shapefiles HUC8", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_max_tempaug <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max_tempaug) <- "Max Temp AUG"
  write.csv(df_max_tempaug, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/tmax AUG/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#6
###HUC8 tmin jan
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmin JAN") #path for prism data
UseCores <- detectCores() -1 #detects one minus the max number of cores
cl <- makeCluster(UseCores) #create copies of R to run parallel
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84") 
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/data.RData")
registerDoParallel(cl)
foreach (i = 1:length(FILES_SHPHUC8)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_SHPHUC8[i], 1, nchar(FILES_SHPHUC8[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\unique HUC8 data\\shapefiles HUC8", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min_tempjan <- t(as.data.frame(lapply(ext2, min, na.rm = TRUE)))
  colnames(df_min_tempjan) <- "Min Temp JAN"
  write.csv(df_min_tempjan, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/tmin JAN/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)



###START OF HUC12 PRISM DATA###
#7
###HUC12 tmax
FILES_SHPHUC12 <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\unique HUC12 data\\shapefiles HUC12\\", pattern = "\\.shp$")#create file list for loop
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmax") #path for prism data
UseCores <- detectCores() -1 #detects one minus the max number of cores
cl <- makeCluster(UseCores) #create copies of R to run parallel
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84") 
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/data.RData")
registerDoParallel(cl)
foreach (i = 1:length(FILES_SHPHUC12)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_SHPHUC12[i], 1, nchar(FILES_SHPHUC12[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\unique HUC12 data\\shapefiles HUC12", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min_tempmax <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min_tempmax) <- "Min Temp Max"
  df_max_tempmax <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max_tempmax) <- "Max Temp Max"
  min_max_tmax <- cbind(df_min_tempmax, df_max_tempmax)
  write.csv(min_max_tmax, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/tmax/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#8
###HUC12 tmin
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmin") #path for prism data
UseCores <- detectCores() -1 #detects one minus the max number of cores
cl <- makeCluster(UseCores) #create copies of R to run parallel
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84") 
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/data.RData")
registerDoParallel(cl)
foreach (i = 1:length(FILES_SHPHUC12)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_SHPHUC12[i], 1, nchar(FILES_SHPHUC12[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\unique HUC12 data\\shapefiles HUC12", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min_tempmin <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min_tempmin) <- "Min Temp Min"
  df_max_tempmin <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max_tempmin) <- "Max Temp Min"
  min_max_tmin <- cbind(df_min_tempmin, df_max_tempmin)
  write.csv(min_max_tmin, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/tmin/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#9
###HUC12 tmean
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmean") #path for prism data
UseCores <- detectCores() -1 #detects one minus the max number of cores
cl <- makeCluster(UseCores) #create copies of R to run parallel
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84") 
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/data.RData")
registerDoParallel(cl)
foreach (i = 1:length(FILES_SHPHUC12)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_SHPHUC12[i], 1, nchar(FILES_SHPHUC12[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\unique HUC12 data\\shapefiles HUC12", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min_tempmean <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min_tempmean) <- "Min Temp Mean"
  df_max_tempmean <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max_tempmean) <- "Max Temp Mean"
  min_max_tmean <- cbind(df_min_tempmean, df_max_tempmean)
  write.csv(min_max_tmean, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/tmean/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#10
###HUC12 ppt
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\ppt") #path for prism data
UseCores <- detectCores() -1 #detects one minus the max number of cores
cl <- makeCluster(UseCores) #create copies of R to run parallel
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84") 
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/data.RData")
registerDoParallel(cl)
foreach (i = 1:length(FILES_SHPHUC12)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_SHPHUC12[i], 1, nchar(FILES_SHPHUC12[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\unique HUC12 data\\shapefiles HUC12", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min_ppt <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min_ppt) <- "Min PPT"
  df_max_ppt <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max_ppt) <- "Max PPT"
  min_max_ppt <- cbind(df_min_ppt, df_max_ppt)
  write.csv(min_max_ppt, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/ppt/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#11
###HUC12 tmax aug
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmax AUG") #path for prism data
UseCores <- detectCores() -1 #detects one minus the max number of cores
cl <- makeCluster(UseCores) #create copies of R to run parallel
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84") 
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/data.RData")
registerDoParallel(cl)
foreach (i = 1:length(FILES_SHPHUC12)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_SHPHUC12[i], 1, nchar(FILES_SHPHUC12[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\unique HUC12 data\\shapefiles HUC12", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_max_tempaug <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max_tempaug) <- "Max Temp AUG"
  write.csv(df_max_tempaug, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/tmax AUG/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#12
###HUC12 tmin jan
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmin JAN") #path for prism data
UseCores <- detectCores() -1 #detects one minus the max number of cores
cl <- makeCluster(UseCores) #create copies of R to run parallel
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84") 
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/data.RData")
registerDoParallel(cl)
foreach (i = 1:length(FILES_SHPHUC12)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_SHPHUC12[i], 1, nchar(FILES_SHPHUC12[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\unique HUC12 data\\shapefiles HUC12", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min_tempjan <- t(as.data.frame(lapply(ext2, min, na.rm = TRUE)))
  colnames(df_min_tempjan) <- "Min Temp JAN"
  write.csv(df_min_tempjan, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/tmin JAN/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)



###START OF MCP PRISM DATA###
FILES_MCP <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\MCP maps\\shapefiles MCP", pattern = "\\.shp$")#create file list for loop

#13
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmax")
###MCP tmax
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
prism_years <- t(ls_prism_data()) #names of the prism data files
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/stack.ffdata")) #allocate space for the stacked raster data
for(i in 1:nlayers(RS)){ #create a matrix the save of the stacked raster data
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/data.RData") #save the empty matrix
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_MCP)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_MCP[i], 1, nchar(FILES_MCP[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\MCP maps\\shapefiles MCP", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]]) 
  ID_Raster[] <- 1:ncell(RS[[1]]) #allows R to know where to extract the information from the stacked raster data to the empty matrix.
  ext_ID <- extract(ID_Raster,species) #extract raster data compared with shapefile
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),]) 
  colnames(ext2) <- prism_years #rename the column 
  df_min <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE))) #min values
  colnames(df_min) <- "Min Temp Max" #rename the column
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE))) #max values
  colnames(df_max) <- "Max Temp Max" #rename the column 
  min_max_tmax <- cbind(df_min, df_max) #combine min and max
  write.csv(min_max_tmax, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/tmax/", dat.name,".csv"), row.names=TRUE) #save the file
} 
stopCluster(cl) #stop the parallel cluster

#14
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmin")
###MCP tmin
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_MCP)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_MCP[i], 1, nchar(FILES_MCP[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\MCP maps\\shapefiles MCP", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min) <- "Min Temp Min"
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max Temp Min"
  min_max_tmin <- cbind(df_min, df_max)
  write.csv(min_max_tmin, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/tmin/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#15
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmean")
###MCP tmean
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_MCP)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_MCP[i], 1, nchar(FILES_MCP[i])-4) #take the shape file nam
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\MCP maps\\shapefiles MCP", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min) <- "Min Temp Mean"
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max Temp Mean"
  min_max_tmean <- cbind(df_min, df_max)
  write.csv(min_max_tmean, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/tmean/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#16
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\ppt")
###MCP ppt
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_MCP)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_MCP[i], 1, nchar(FILES_MCP[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\MCP maps\\shapefiles MCP", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min) <- "Min PPT"
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max PPT"
  min_max_ppt <- cbind(df_min, df_max)
  write.csv(min_max_ppt, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/ppt/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#17
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmax Aug")
###MCP tmax aug
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_MCP)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_MCP[i], 1, nchar(FILES_MCP[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\MCP maps\\shapefiles MCP", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max Temp AUG"
  max_tempAUG <-  df_max
  write.csv(max_tempAUG, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/tmax AUG/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#18
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmin JAN")
###MCP tmin jan
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_MCP)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_MCP[i], 1, nchar(FILES_MCP[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\MCP maps\\shapefiles MCP", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2, min, na.rm = TRUE)))
  colnames(df_min) <- "Min Temp JAN"
  min_tempJAN <-  df_min
  write.csv(min_tempJAN, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/tmin JAN/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#19
###START OF 1 KM BUFFER PRISM DATA###
FILES_buffer <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\1 km buffer\\1km buffer shapefiles", pattern = "\\.shp$")#create file list for loop
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmax")
###1km buffer tmax
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/data.RData")
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\1 km buffer\\1km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 1000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min_tempmax <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min_tempmax) <- "Min Temp Max"
  df_max_tempmax <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max_tempmax) <- "Max Temp Max"
  min_max_tmax <- cbind(df_min_tempmax, df_max_tempmax)
  write.csv(min_max_tmax, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/tmax/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#20
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmin")
###1km buffer tmin
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\1 km buffer\\1km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 1000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min_tempmin <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min_tempmin) <- "Min Temp Min"
  df_max_tempmin <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max_tempmin) <- "Max Temp Min"
  min_max_tmin <- cbind(df_min_tempmin, df_max_tempmin)
  write.csv(min_max_tmin, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/tmin/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#21
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmean")
###1km buffer tmean
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\1 km buffer\\1km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 1000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min_tempmean <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min_tempmean) <- "Min Temp Mean"
  df_max_tempmean <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max_tempmean) <- "Max Temp Mean"
  min_max_tmean <- cbind(df_min_tempmean, df_max_tempmean)
  write.csv(min_max_tmean, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/tmean/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#22
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\ppt")
###1km buffer ppt
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\1 km buffer\\1km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 1000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min_ppt <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min_ppt) <- "Min PPT"
  df_max_ppt <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max_ppt) <- "Max PPT"
  min_max_ppt <- cbind(df_min_ppt, df_max_ppt)
  write.csv(min_max_ppt, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/ppt/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#23
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmax Aug")
###1km buffer tmax aug
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\1 km buffer\\1km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 1000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_max_tempaug <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max_tempaug) <- "Max Temp AUG"
  write.csv(df_max_tempaug, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/tmax AUG/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#24
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmin JAN")
###1km buffer tmin jan
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\1 km buffer\\1km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 1000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min_tempjan <- t(as.data.frame(lapply(ext2, min, na.rm = TRUE)))
  colnames(df_min_tempjan) <- "Min Temp JAN"
  write.csv(df_min_tempjan, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/tmin JAN/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#25
###START OF 5KM BUFFER PRISM DATA###
FILES_buffer <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\5 km buffer\\5km buffer shapefiles", pattern = "\\.shp$")#create file list for loop
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmax")
###5km buffer tmax
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/data.RData")
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\5 km buffer\\5km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 5000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min) <- "Min Temp Max"
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max Temp Max"
  min_max_tmax <- cbind(df_min, df_max)
  write.csv(min_max_tmax, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/tmax/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#26
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmin")
###5km buffer tmin
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/data.RData")
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\5 km buffer\\5km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 5000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min) <- "Min Temp Min"
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max Temp Min"
  min_max_tmin <- cbind(df_min, df_max)
  write.csv(min_max_tmin, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/tmin/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#27
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmean")
###5km buffer tmean
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/data.RData")
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\5 km buffer\\5km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 5000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min) <- "Min Temp Mean"
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max Temp Mean"
  min_max_tmean <- cbind(df_min, df_max)
  write.csv(min_max_tmean, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/tmean/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#28
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\ppt")
###5km buffer ppt
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\5 km buffer\\5km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 5000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min) <- "Min PPT"
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max PPT"
  min_max_ppt <- cbind(df_min, df_max)
  write.csv(min_max_ppt, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/ppt/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#29
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmax Aug")
###5km buffer tmax aug
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\5 km buffer\\5km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 5000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max Temp AUG"
  max_tempAUG <-  df_max
  write.csv(max_tempAUG, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/tmax AUG/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#30
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmin JAN")
###5km buffer tmin jan
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\5 km buffer\\5km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 5000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2, min, na.rm = TRUE)))
  colnames(df_min) <- "Min Temp JAN"
  min_tempJAN <-  df_min
  write.csv(min_tempJAN, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/tmin JAN/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#31
###START OF 10KM BUFFER PRISM DATA###
FILES_buffer <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\10 km buffer\\10km buffer shapefiles", pattern = "\\.shp$")#create file list for loop
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmax")
###10km buffer tmax
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/data.RData")
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\10 km buffer\\10km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 10000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min) <- "Min Temp Max"
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max Temp Max"
  min_max_tmax <- cbind(df_min, df_max)
  write.csv(min_max_tmax, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/tmax/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#32
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmin")
###10km buffer tmin
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\10 km buffer\\10km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 10000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min) <- "Min Temp Min"
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max Temp Min"
  min_max_tmin <- cbind(df_min, df_max)
  write.csv(min_max_tmin, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/tmin/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#33
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmean")
###10km buffer tmean
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\10 km buffer\\10km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 10000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min) <- "Min Temp Mean"
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max Temp Mean"
  min_max_tmean <- cbind(df_min, df_max)
  write.csv(min_max_tmean, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/tmean/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#34
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\ppt")
###10km ppt
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\10 km buffer\\10km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 10000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min) <- "Min PPT"
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max PPT"
  min_max_ppt <- cbind(df_min, df_max)
  write.csv(min_max_ppt, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/ppt/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#35
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmax Aug")
###10km buffer tmax aug
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\10 km buffer\\10km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 10000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max Temp AUG"
  max_tempAUG <-  df_max
  write.csv(max_tempAUG, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/tmax AUG/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#36
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmin JAN")
###10km buffer tmin jan
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\10 km buffer\\10km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 10000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2, min, na.rm = TRUE)))
  colnames(df_min) <- "Min Temp JAN"
  min_tempJAN <-  df_min
  write.csv(min_tempJAN, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/tmin JAN/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#37
###START OF 20KM BUFFER PRISM DATA###
FILES_buffer <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\20 km buffer\\20km buffer shapefiles", pattern = "\\.shp$")#create file list for loop
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmax")
###20km buffer tmax
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
prism_years <- t(ls_prism_data())
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/data.RData")
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\20 km buffer\\20km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 20000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min) <- "Min Temp Max"
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max Temp Max"
  min_max_tmax <- cbind(df_min, df_max)
  write.csv(min_max_tmax, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/tmax/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#38
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmin")
###20km buffer tmin
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\20 km buffer\\20km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 20000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min) <- "Min Temp Min"
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max Temp Min"
  min_max_tmin <- cbind(df_min, df_max)
  write.csv(min_max_tmin, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/tmin/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#39
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmean")
###20km buffer tmean
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\20 km buffer\\20km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 20000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min) <- "Min Temp Mean"
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max Temp Mean"
  min_max_tmean <- cbind(df_min, df_max)
  write.csv(min_max_tmean, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/tmean/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#40
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\ppt")
###20km buffer ppt
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\20 km buffer\\20km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 20000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2 ,min, na.rm = TRUE)))
  colnames(df_min) <- "Min PPT"
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max PPT"
  min_max_ppt <- cbind(df_min, df_max)
  write.csv(min_max_ppt, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/ppt/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#41
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmax Aug")
###20km buffer tmax aug
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\20 km buffer\\20km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 20000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_max <- t(as.data.frame(lapply(ext2, max, na.rm = TRUE)))
  colnames(df_max) <- "Max Temp AUG"
  max_tempAUG <-  df_max
  write.csv(max_tempAUG, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/tmax AUG/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)

#42
options(prism.path = "C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\tmin JAN")
###20km buffer tmin jan
RS <- prism_stack(ls_prism_data()) #raster data
proj4string(RS)<-CRS("+init=epsg:4326 +proj=longlat +ellps=WGS84 +datum=WGS84")
mat <- ff(vmode="double",dim=c(ncell(RS),nlayers(RS)),filename=paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/stack.ffdata"))
for(i in 1:nlayers(RS)){
  mat[,i] <- RS[[i]][]
}
save(mat,file="C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/data.RData")
UseCores <- detectCores() -1
cl <- makeCluster(UseCores)
registerDoParallel(cl)
foreach (i = 1:length(FILES_buffer)) %dopar% {
  library(rgdal)
  library(raster)
  library(ff)
  dat.name <- substr(FILES_buffer[i], 1, nchar(FILES_buffer[i])-4) #take the shape file name
  species <- readOGR("C:\\Users\\MimsLab\\Documents\\Ye\\buffer map\\20 km buffer\\20km buffer shapefiles", dat.name) #read in the shapefile
  ID_Raster <- raster(RS[[1]])
  ID_Raster[] <- 1:ncell(RS[[1]])
  ext_ID <- extract(ID_Raster,species, buffer = 20000)
  ext2 <- as.data.frame(mat[as.numeric(unlist(ext_ID)),])
  colnames(ext2) <- prism_years
  df_min <- t(as.data.frame(lapply(ext2, min, na.rm = TRUE)))
  colnames(df_min) <- "Min Temp JAN"
  min_tempJAN <-  df_min
  write.csv(min_tempJAN, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/tmin JAN/", dat.name,".csv"), row.names=TRUE)
}
stopCluster(cl)


###AFTER THE INDIVIDUAL FILES HAVE BEEN CREATED FROM THE ABOVE CODE###
###THIS SECTION, COMBINES ALL THE METRICS INTO ONE EXCEL FILE FOR EACH
###AOO, SPECIES, AND YEAR ###

rm(list=ls())

FILES_1KMMAX <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\1 km buffer\\tmax", pattern = "\\.csv")#create file list for loop
FILES_1KMMIN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\1 km buffer\\tmin", pattern = "\\.csv")#create file list for loop
FILES_1KMMEAN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\1 km buffer\\tmean", pattern = "\\.csv")#create file list for loop
FILES_1KMPPT <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\1 km buffer\\ppt", pattern = "\\.csv")#create file list for loop
FILES_1KMMAXAUG <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\1 km buffer\\tmax AUG", pattern = "\\.csv")#create file list for loop
FILES_1KMMINJAN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\1 km buffer\\tmin JAN", pattern = "\\.csv")#create file list for loop

#43
for (i in 1:length(FILES_1KMMEAN)){
  
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\1 km buffer\\tmax")
  datfilemax <- read.csv(FILES_1KMMAX[i], header=TRUE) #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\1 km buffer\\tmin")
  datfilemin <- read.csv(FILES_1KMMIN[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\1 km buffer\\tmean")
  datfilemean <- read.csv(FILES_1KMMEAN[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\1 km buffer\\ppt")
  datfileppt <- read.csv(FILES_1KMPPT[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\1 km buffer\\tmax AUG")
  datfilemaxaug <- as.data.frame(read.csv(FILES_1KMMAXAUG[i], header=TRUE)[,2]) #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\1 km buffer\\tmin JAN")
  datfileminjan <- as.data.frame(read.csv(FILES_1KMMINJAN[i], header=TRUE)[,2]) #read in the file from  the list
  
  
  
  completed_file <- cbind(datfilemax, datfilemin, datfilemean, datfileppt, datfilemaxaug, datfileminjan)
  names(completed_file)[c(1,10:11)] <- c("Years","Max.Temp.Aug", "Min.Temp.Jan")
  completed_file["Years"] <- c(1895:1980, 1982:2014)
  write.csv(completed_file, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/1 km buffer/complete/", FILES_1KMMAX[i]), row.names=FALSE)
}


FILES_5KMMAX <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\5 km buffer\\tmax", pattern = "\\.csv")#create file list for loop
FILES_5KMMIN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\5 km buffer\\tmin", pattern = "\\.csv")#create file list for loop
FILES_5KMMEAN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\5 km buffer\\tmean", pattern = "\\.csv")#create file list for loop
FILES_5KMPPT <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\5 km buffer\\ppt", pattern = "\\.csv")#create file list for loop
FILES_5KMMAXAUG <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\5 km buffer\\tmax AUG", pattern = "\\.csv")#create file list for loop
FILES_5KMMINJAN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\5 km buffer\\tmin JAN", pattern = "\\.csv")#create file list for loop

#44
for (i in 1:length(FILES_5KMMEAN)){
  
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\5 km buffer\\tmax")
  datfilemax <- read.csv(FILES_5KMMAX[i], header=TRUE) #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\5 km buffer\\tmin")
  datfilemin <- read.csv(FILES_5KMMIN[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\5 km buffer\\tmean")
  datfilemean <- read.csv(FILES_5KMMEAN[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\5 km buffer\\ppt")
  datfileppt <- read.csv(FILES_5KMPPT[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\5 km buffer\\tmax AUG")
  datfilemaxaug <- as.data.frame(read.csv(FILES_5KMMAXAUG[i], header=TRUE)[,2]) #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\5 km buffer\\tmin JAN")
  datfileminjan <- as.data.frame(read.csv(FILES_5KMMINJAN[i], header=TRUE)[,2]) #read in the file from  the list
  
  
  
  completed_file <- cbind(datfilemax, datfilemin, datfilemean, datfileppt, datfilemaxaug, datfileminjan)
  names(completed_file)[c(1,10:11)] <- c("Years","Max.Temp.Aug", "Min.Temp.Jan")
  completed_file["Years"] <- c(1895:1980, 1982:2014)
  write.csv(completed_file, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/5 km buffer/complete/", FILES_5KMMAX[i]), row.names=FALSE)
}

FILES_10KMMAX <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\10 km buffer\\tmax", pattern = "\\.csv")#create file list for loop
FILES_10KMMIN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\10 km buffer\\tmin", pattern = "\\.csv")#create file list for loop
FILES_10KMMEAN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\10 km buffer\\tmean", pattern = "\\.csv")#create file list for loop
FILES_10KMPPT <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\10 km buffer\\ppt", pattern = "\\.csv")#create file list for loop
FILES_10KMMAXAUG <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\10 km buffer\\tmax AUG", pattern = "\\.csv")#create file list for loop
FILES_10KMMINJAN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\10 km buffer\\tmin JAN", pattern = "\\.csv")#create file list for loop

#45
for (i in 1:length(FILES_10KMMEAN)){
  
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\10 km buffer\\tmax")
  datfilemax <- read.csv(FILES_10KMMAX[i], header=TRUE) #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\10 km buffer\\tmin")
  datfilemin <- read.csv(FILES_10KMMIN[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\10 km buffer\\tmean")
  datfilemean <- read.csv(FILES_10KMMEAN[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\10 km buffer\\ppt")
  datfileppt <- read.csv(FILES_10KMPPT[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\10 km buffer\\tmax AUG")
  datfilemaxaug <- as.data.frame(read.csv(FILES_10KMMAXAUG[i], header=TRUE)[,2]) #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\10 km buffer\\tmin JAN")
  datfileminjan <- as.data.frame(read.csv(FILES_10KMMINJAN[i], header=TRUE)[,2]) #read in the file from  the list
  
  
  
  completed_file <- cbind(datfilemax, datfilemin, datfilemean, datfileppt, datfilemaxaug, datfileminjan)
  names(completed_file)[c(1,10:11)] <- c("Years","Max.Temp.Aug", "Min.Temp.Jan")
  completed_file["Years"] <- c(1895:1980, 1982:2014)
  write.csv(completed_file, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/10 km buffer/complete/", FILES_10KMMAX[i]), row.names=FALSE)
}

FILES_20KMMAX <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\20 km buffer\\tmax", pattern = "\\.csv")#create file list for loop
FILES_20KMMIN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\20 km buffer\\tmin", pattern = "\\.csv")#create file list for loop
FILES_20KMMEAN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\20 km buffer\\tmean", pattern = "\\.csv")#create file list for loop
FILES_20KMPPT <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\20 km buffer\\ppt", pattern = "\\.csv")#create file list for loop
FILES_20KMMAXAUG <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\20 km buffer\\tmax AUG", pattern = "\\.csv")#create file list for loop
FILES_20KMMINJAN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\20 km buffer\\tmin JAN", pattern = "\\.csv")#create file list for loop

#46
for (i in 1:length(FILES_20KMMEAN)){
  
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\20 km buffer\\tmax")
  datfilemax <- read.csv(FILES_20KMMAX[i], header=TRUE) #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\20 km buffer\\tmin")
  datfilemin <- read.csv(FILES_20KMMIN[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\20 km buffer\\tmean")
  datfilemean <- read.csv(FILES_20KMMEAN[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\20 km buffer\\ppt")
  datfileppt <- read.csv(FILES_20KMPPT[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\20 km buffer\\tmax AUG")
  datfilemaxaug <- as.data.frame(read.csv(FILES_20KMMAXAUG[i], header=TRUE)[,2]) #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\20 km buffer\\tmin JAN")
  datfileminjan <- as.data.frame(read.csv(FILES_20KMMINJAN[i], header=TRUE)[,2]) #read in the file from  the list
  
  
  
  completed_file <- cbind(datfilemax, datfilemin, datfilemean, datfileppt, datfilemaxaug, datfileminjan)
  names(completed_file)[c(1,10:11)] <- c("Years","Max.Temp.Aug", "Min.Temp.Jan")
  completed_file["Years"] <- c(1895:1980, 1982:2014)
  write.csv(completed_file, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/20 km buffer/complete/", FILES_20KMMAX[i]), row.names=FALSE)
}


FILES_HUC8MAX <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC8 prism\\tmax", pattern = "\\.csv")#create file list for loop
FILES_HUC8MIN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC8 prism\\tmin", pattern = "\\.csv")#create file list for loop
FILES_HUC8MEAN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC8 prism\\tmean", pattern = "\\.csv")#create file list for loop
FILES_HUC8PPT <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC8 prism\\ppt", pattern = "\\.csv")#create file list for loop
FILES_HUC8MAXAUG <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC8 prism\\tmax AUG", pattern = "\\.csv")#create file list for loop
FILES_HUC8MINJAN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC8 prism\\tmin JAN", pattern = "\\.csv")#create file list for loop

#47
for (i in 1:length(FILES_HUC8MEAN)){
  
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC8 prism\\tmax")
  datfilemax <- read.csv(FILES_HUC8MAX[i], header=TRUE) #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC8 prism\\tmin")
  datfilemin <- read.csv(FILES_HUC8MIN[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC8 prism\\tmean")
  datfilemean <- read.csv(FILES_HUC8MEAN[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC8 prism\\ppt")
  datfileppt <- read.csv(FILES_HUC8PPT[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC8 prism\\tmax AUG")
  datfilemaxaug <- as.data.frame(read.csv(FILES_HUC8MAXAUG[i], header=TRUE)[,2]) #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC8 prism\\tmin JAN")
  datfileminjan <- as.data.frame(read.csv(FILES_HUC8MINJAN[i], header=TRUE)[,2]) #read in the file from  the list
  
  
  
  completed_file <- cbind(datfilemax, datfilemin, datfilemean, datfileppt, datfilemaxaug, datfileminjan)
  names(completed_file)[c(1,10:11)] <- c("Years","Max.Temp.Aug", "Min.Temp.Jan")
  completed_file["Years"] <- c(1895:1980, 1982:2014)
  write.csv(completed_file, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC8 prism/complete/", FILES_HUC8MAX[i]), row.names=FALSE)
}


FILES_HUC12MAX <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC12 prism\\tmax", pattern = "\\.csv")#create file list for loop
FILES_HUC12MIN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC12 prism\\tmin", pattern = "\\.csv")#create file list for loop
FILES_HUC12MEAN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC12 prism\\tmean", pattern = "\\.csv")#create file list for loop
FILES_HUC12PPT <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC12 prism\\ppt", pattern = "\\.csv")#create file list for loop
FILES_HUC12MAXAUG <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC12 prism\\tmax AUG", pattern = "\\.csv")#create file list for loop
FILES_HUC12MINJAN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC12 prism\\tmin JAN", pattern = "\\.csv")#create file list for loop

#48
for (i in 1:length(FILES_HUC12MEAN)){
  
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC12 prism\\tmax")
  datfilemax <- read.csv(FILES_HUC12MAX[i], header=TRUE) #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC12 prism\\tmin")
  datfilemin <- read.csv(FILES_HUC12MIN[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC12 prism\\tmean")
  datfilemean <- read.csv(FILES_HUC12MEAN[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC12 prism\\ppt")
  datfileppt <- read.csv(FILES_HUC12PPT[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC12 prism\\tmax AUG")
  datfilemaxaug <- as.data.frame(read.csv(FILES_HUC12MAXAUG[i], header=TRUE)[,2]) #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\HUC12 prism\\tmin JAN")
  datfileminjan <- as.data.frame(read.csv(FILES_HUC12MINJAN[i], header=TRUE)[,2]) #read in the file from  the list
  
  
  
  completed_file <- cbind(datfilemax, datfilemin, datfilemean, datfileppt, datfilemaxaug, datfileminjan)
  names(completed_file)[c(1,10:11)] <- c("Years","Max.Temp.Aug", "Min.Temp.Jan")
  completed_file["Years"] <- c(1895:1980, 1982:2014)
  write.csv(completed_file, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/HUC12 prism/complete/", FILES_HUC12MAX[i]), row.names=FALSE)
}

FILES_MCPMAX <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\MCP\\tmax", pattern = "\\.csv")#create file list for loop
FILES_MCPMIN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\MCP\\tmin", pattern = "\\.csv")#create file list for loop
FILES_MCPMEAN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\MCP\\tmean", pattern = "\\.csv")#create file list for loop
FILES_MCPPPT <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\MCP\\ppt", pattern = "\\.csv")#create file list for loop
FILES_MCPMAXAUG <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\MCP\\tmax AUG", pattern = "\\.csv")#create file list for loop
FILES_MCPMINJAN <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\MCP\\tmin JAN", pattern = "\\.csv")#create file list for loop

#49
for (i in 1:length(FILES_MCPMEAN)){
  
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\MCP\\tmax")
  datfilemax <- read.csv(FILES_MCPMAX[i], header=TRUE) #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\MCP\\tmin")
  datfilemin <- read.csv(FILES_MCPMIN[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\MCP\\tmean")
  datfilemean <- read.csv(FILES_MCPMEAN[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\MCP\\ppt")
  datfileppt <- read.csv(FILES_MCPPPT[i], header=TRUE)[,2:3] #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\MCP\\tmax AUG")
  datfilemaxaug <- as.data.frame(read.csv(FILES_MCPMAXAUG[i], header=TRUE)[,2]) #read in the file from  the list
  setwd("C:\\Users\\MimsLab\\Documents\\Ye\\Prism Data\\MCP\\tmin JAN")
  datfileminjan <- as.data.frame(read.csv(FILES_MCPMINJAN[i], header=TRUE)[,2]) #read in the file from  the list
  
  
  
  completed_file <- cbind(datfilemax, datfilemin, datfilemean, datfileppt, datfilemaxaug, datfileminjan)
  names(completed_file)[c(1,10:11)] <- c("Years","Max.Temp.Aug", "Min.Temp.Jan")
  completed_file["Years"] <- c(1895:1980, 1982:2014)
  write.csv(completed_file, file =paste0("C:/Users/MimsLab/Documents/Ye/Prism Data/MCP/complete/", FILES_MCPMAX[i]), row.names=FALSE)
}

