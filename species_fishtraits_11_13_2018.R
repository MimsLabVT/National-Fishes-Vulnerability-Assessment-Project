rm(list=ls())




#takes fishtraits from the FishTraits database (directly obtained from Emmanual Frimpong at Virginia Tech)
#and extracts data for the species represented in the final species list (n=128)


fishtraits <- read.csv("C:\\Users\\MimsLab\\Documents\\Ye\\FishTraitsSpeciesSelection.csv", header = TRUE)

setwd("C:/Users/MimsLab/Documents/Ye/Final location data") #set working directory to path of raw data

FILES <- list.files(path="C:\\Users\\MimsLab\\Documents\\Ye\\Final location data\\", pattern = ".csv")#create file list for loop

species_fishtraits = NULL

for (i in 1:length(FILES)){
  dat <- read.csv(FILES[i], header=TRUE)
  species <- as.character(dat[2,10])
  species_split <- strsplit(species, " ")
  species_split <- as.data.frame(unlist(species_split))
  a_species = as.character(species_split[2,1])
  b_genus = as.character(species_split[1,1])
  extraction <- fishtraits[which(fishtraits$SPECIES == a_species & fishtraits$GENUS == b_genus),]

  species_fishtraits[[i]] <- extraction
  
}
species_fishtraits1 <- do.call(rbind.data.frame, species_fishtraits)


a <- "Phoxinus"
b <- "erythrogaster"

extraction <- fishtraits[which(fishtraits$SPECIES == b & fishtraits$GENUS == a),]

species_fishtraits1[120,] <- extraction

a <- "Lampetra"
b <- "tridentata"

extraction <- fishtraits[which(fishtraits$SPECIES == b & fishtraits$GENUS == a),]

species_fishtraits1[121,] <- extraction

a <- "Cycleptus"
b <- "elongatus"

extraction <- fishtraits[which(fishtraits$SPECIES == b & fishtraits$GENUS == a),]

species_fishtraits1[122,] <- extraction

a <- "Moxostoma"
b <- "duquesnei"

extraction <- fishtraits[which(fishtraits$SPECIES == b & fishtraits$GENUS == a),]

species_fishtraits1[123,] <- extraction



write.csv(species_fishtraits1, file = "C:\\Users\\MimsLab\\Documents\\Ye\\species_fishtraits.csv", row.names = FALSE)  #save the dataframe


#subsetting the first traits

specie_fishtraits <- read.csv("C:\\Users\\MimsLab\\Documents\\Ye\\species_fishtraits.csv", header = TRUE)
attach(specie_fishtraits)
specie_fishtraits_filtered <- subset(specie_fishtraits, select=-c(FamilyNumber, JAN:DEC, REPSTATE, EURYHALINE:LATCENTROID, 
                                                         AREAKM2:LONRANGE, LIST1:EXTINCT))

write.csv(specie_fishtraits_filtered, file = "C:\\Users\\MimsLab\\Documents\\Ye\\specie_fishtraits_filtered.csv", row.names = FALSE)  #save the dataframe


fishtraits_filtered <- subset(fishtraits, select=-c(FamilyNumber, JAN:DEC, REPSTATE, EURYHALINE:LATCENTROID, 
                                                           AREAKM2:LONRANGE, LIST1:EXTINCT))


write.csv(fishtraits_filtered, file = "C:\\Users\\MimsLab\\Documents\\Ye\\fishtraits_filtered.csv", row.names = FALSE)  #save the dataframe
