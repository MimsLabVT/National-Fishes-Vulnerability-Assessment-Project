#This code takes the area of occupancy (AOO) output and ranks AOOs in order of size (1=smallest, 129=largest) for each of the 7 range size metrics used to estimate AOOs.
#It then scales all of the means (n=129) between 0 and 1
#It then calculates mean and standard deviations for the ranks for each species. Code was written by J A Smith (contact=jennifer.smith@utsa.edu) on 10/16/2018

install.packages("scales")
library("scales")

#Clears environment (if needed)
rm(list=ls())


#reads in output from area of occupancy analysis. Change location of files if appropriate

Buffer_1km <- read.csv(file="C:\\Users\\rrd600\\OneDrive - University of Texas at San Antonio\\Mims\\AOOData\\Buffer1km_AllSpecies.csv")
Buffer_5km <- read.csv(file="C:\\Users\\rrd600\\OneDrive - University of Texas at San Antonio\\Mims\\AOOData\\Buffer5km_AllSpecies.csv")
Buffer_10km <- read.csv(file="C:\\Users\\rrd600\\OneDrive - University of Texas at San Antonio\\Mims\\AOOData\\Buffer10km_AllSpecies.csv")
Buffer_20km <- read.csv(file="C:\\Users\\rrd600\\OneDrive - University of Texas at San Antonio\\Mims\\AOOData\\Buffer20km_AllSpecies.csv")
HUC12 <- read.csv(file="C:\\Users\\rrd600\\OneDrive - University of Texas at San Antonio\\Mims\\AOOData\\HUC12_AllSpecies.csv")
HUC8 <- read.csv(file="C:\\Users\\rrd600\\OneDrive - University of Texas at San Antonio\\Mims\\AOOData\\HUC8_AllSpecies.csv")
MCP <- read.csv(file="C:\\Users\\rrd600\\OneDrive - University of Texas at San Antonio\\Mims\\AOOData\\MCP_AllSpecies.csv")


#Adds columns to each AOO dataframe and stores ranks (rank from 1 to 129 with 1 being the smallest area of occupancy)

Buffer_1km$rank1km <- rank(Buffer_1km$total_area_1km)
Buffer_5km$rank5km <- rank(Buffer_5km$total_area_5km)
Buffer_10km$rank10km <- rank(Buffer_10km$total_area_10km)
Buffer_20km$rank20km <- rank(Buffer_20km$total_area_20km)
HUC12$rankHUC12 <- rank(HUC12$total_area_huc12)
HUC8$rankHUC8 <- rank(HUC8$total_area_huc8)
MCP$RankMCP <- rank(MCP$MCP.area..Km.2.)

#Merges the 7 dataframes for the 7 metrics and removes suplicate columns (e.g., species names)

MergedAOO<- cbind(Buffer_1km,Buffer_5km,Buffer_10km, Buffer_20km, HUC8, HUC12, MCP)
All_AOO <- MergedAOO[-c(5,6,9,10,13,14,17,18,21,22,25,26)]


#creates columns for mean and standard deviations to be stored

All_AOO$mean <-NA
All_AOO$sd <- NA

#loop to calculate and store mean of the 7 ranks in the mean column

for(i in 1:nrow(All_AOO)){
  All_AOO[i,]$mean <- mean(c(All_AOO[i,]$rank1km,  All_AOO[i,]$rank5km,  All_AOO[i,]$rank10km, All_AOO[i,]$rank20km, All_AOO[i,]$rankHUC8, All_AOO[i,]$rankHUC12, All_AOO[i,]$RankMCP ), na.rm=TRUE)
}

#loop to calculate and store standard deviation of the 7 ranks in the sd column


for(i in 1:nrow(All_AOO)){
  All_AOO[i,]$sd <- sd(c(All_AOO[i,]$rank1km,  All_AOO[i,]$rank5km,  All_AOO[i,]$rank10km, All_AOO[i,]$rank20km, All_AOO[i,]$rankHUC8, All_AOO[i,]$rankHUC12, All_AOO[i,]$RankMCP), na.rm=TRUE)
}


All_AOO$StandardizedMean <- rescale(All_AOO$mean, to =c(0,1))


#Calculates and stores coefficient of variation (cv) for the rankings in a new column entitled 'cv'

All_AOO$cv <- (All_AOO$sd/All_AOO$mean)*100


#exports results to a .csv. Change output file location if appropriate

write.csv(All_AOO,"C:\\Users\\rrd600\\Documents\\All_AOO.csv")

